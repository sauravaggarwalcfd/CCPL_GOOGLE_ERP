+-----------------------------------------------------------------------+
| **CONFIDENCE CLOTHING ERP**                                           |
+-----------------------------------------------------------------------+
| **Google Apps Script â€” Custom Build Instructions**                    |
|                                                                       |
| Based on CC_ERP_BUILD_REFERENCE_V7.md â€¢ All Locked Decisions Included |
| V7 â€¢ Feb 2026 â€¢ 56 Masters + 7 Procurement = 63 Sheets               |
+-----------------------------------------------------------------------+

**1. SYSTEM ARCHITECTURE & FILE STRUCTURE**

The ERP is split across three Google Sheets master files plus transaction
files. Every GAS function must respect file boundaries.

  ---------- --------------------- ------------- ---------------------------
  **File**   **Name**              **Sheets**    **Access**

  FILE 1A    CC ERP Masters        27 sheets     MD / Admin only
             (Items)               (was 23,      
                                   +4 Notion     
                                   config +      
                                   HELP_CONTENT) 

  FILE 1B    CC ERP Masters        23 sheets     Factory Mgr / HR / Admin
             (Factory)             (was 19,      
                                   +3 Notion     
                                   config +      
                                   AUTOMATION)   

  FILE 1C    CC ERP Masters        6 sheets      Accounts team only
             (Finance)                           

  FILE 2     CC ERP Procurement    7 sheets      Purchase Mgr / Admin
             (Transactions)        (PO+GRN+      
                                   Templates+    
                                   Comments)     
  ---------- --------------------- ------------- ---------------------------

> **ğŸ”’ RULE:** ITEM_SUPPLIER_RATES is in FILE 1B (Sheet 43) â€” NOT FILE
> 1A. Always treat Supplier Code in it as a cross-file FK to FILE 1C.

> **ğŸ”’ RULE (V7):** React is the REAL frontend. GAS = backend API only
> via google.script.run. All UI rendered by React served via doGet().

**2. MANDATORY SHEET STRUCTURE â€” EVERY MASTER SHEET**

Every master sheet must follow this exact row structure. No exceptions.

  --------- ------------------------ -----------------------------------
  **Row**   **Purpose**              **Style Required**

  Row 1     Banner: File label +     Dark background, white text â€”
            Sheet name + Description spans full width

  Row 2     Column headers           Red background (#CC0000), white
                                     bold text â€” FROZEN

  Row 3     Field descriptions       Light blue background, italic â€”
            (italic)                 FROZEN

  Row 4+    Data rows                Category-colored alternating rows
  --------- ------------------------ -----------------------------------

> **ğŸ”’ RULE:** Freeze pane must ALWAYS be set at A4 (rows 1â€“3 frozen,
> columns NEVER frozen).

**Sheet Tab Colors**

  ---------- --------------------- ----------------------------------------
  **File**   **Sheet Type**        **Tab Color (Hex)**

  FILE 1A    Item masters          #1A1A2E (Dark Navy)
  FILE 1A    TRIM_MASTER           #4A0E4E (Purple)
  FILE 1A    Trim attr sheets      #2D0A4E / #1A0A3A (Deeper Purple)
  FILE 1A    Notion config sheets  #0D4F4F (Config Teal) â˜… V7
  FILE 1A    HELP_CONTENT          #1A5276 (Help Blue) â˜… V7
  FILE 1B    Factory masters       #2C3E50 (Dark Slate)
  FILE 1B    ITEM_SUPPLIER_RATES   #004D40 (Teal)
  FILE 1C    Finance masters       #1A3A4A (Dark Steel)
  FILE 2     Procurement masters   #8B4513 (Procurement Brown) â˜… V7
  ---------- --------------------- ----------------------------------------

**3. COLUMN HEADER ICON CONVENTION**

All column headers must use the following prefix icons. GAS reads these
to determine field behaviour.

  ---------- ------------------ ------------------------------------------------
  **Icon**   **Meaning**        **GAS Behaviour**

  â†’          FK column pointing Store code only. Never copy data. Adjacent â†
             TO another master  col for display.

  â†          Auto-display       Read-only. GAS fills via autoDisplayFKName().
             pulled FROM        User cannot edit.
             another master     

  âŸ·          Two-way sync       Chip panel in sidebar. Toggle on/off. New
             column (attrs,     values prompt to add.
             tags)              

  âˆ‘          Calculated field   GAS computes. Never type. Always recalculate
                                on onEdit().

  âš           Mandatory field    GAS validates before saving. Block save if
                                blank.

  \#         Auto-generated by  Never allow manual entry. Lock cell. Generate
             GAS                on row insert.

  ğŸ”‘         Primary key / code Unique constraint. GAS checks duplicates
             column             before saving.
  ---------- ------------------ ------------------------------------------------

**4. ITEM CODING RULES â€” ALL MASTERS**

> **ğŸ”’ RULE:** NO company prefix (CC-) anywhere. This is permanently
> locked. Never prefix any code with CC-.

  --------------------- --------------------- ------------- -----------------
  **Master**            **Code Format**       **Example**   **Generated By**

  ARTICLE_MASTER        4â€“5 digits + 2 CAPS   5249HP,       Manual â€” user
                                              54568HR       types

  RM_MASTER_FABRIC      RM-FAB-[SEQ]          RM-FAB-001    AUTO by GAS

  RM_MASTER_YARN        RM-YRN-[SEQ]          RM-YRN-001    AUTO by GAS

  RM_MASTER_WOVEN       RM-WVN-[SEQ]          RM-WVN-001    AUTO by GAS

  TRIM_MASTER           TRM-[CAT]-[SEQ]       TRM-THD-001   AUTO by GAS

  CONSUMABLE_MASTER     CON-[CAT]-[SEQ]       CON-DYE-001   AUTO by GAS

  PACKAGING_MASTER      PKG-[CAT]-[SEQ]       PKG-PLY-001   AUTO by GAS

  SUPPLIER_MASTER       SUP-[SEQ]             SUP-001       AUTO by GAS

  ITEM_SUPPLIER_RATES   ISR-[5-digit SEQ]     ISR-00001     AUTO by GAS

  PO_MASTER â˜… V7        PO-[YYYY]-[5-SEQ]     PO-2026-00001 AUTO by GAS

  GRN_MASTER â˜… V7       GRN-[YYYY]-[5-SEQ]    GRN-2026-00001 AUTO by GAS

  Notion Config IDs     [PREFIX]-[3-SEQ]      WF-001,       AUTO by GAS
  â˜… V7                                        EMB-001,      
                                              RUP-001,      
                                              TPL-001,      
                                              AUT-001,      
                                              HLP-001       
  --------------------- --------------------- ------------- -----------------

**5. FOREIGN KEY (FK) RELATIONSHIP ENGINE**

The FK system is driven entirely by MASTER_RELATIONS sheets. GAS reads
config â€” no FK logic is hardcoded.

  - FILE 1A: MASTER_RELATIONS (REL-001 to REL-046)
  - FILE 2:  MASTER_RELATIONS_F2 (REL-047 to REL-054) â˜… V7

> **ğŸ”’ RULE:** Store ONLY the code in FK columns. NEVER copy data
> between sheets. The adjacent â† column shows the display name.

**MASTER_RELATIONS Sheet Columns**

  ğŸ”‘ Relation Code | â†’ Parent Sheet | â†’ Parent Column |
  â† Referenced Sheet | â† Ref Code Column | â† Ref Display Col |
  âŸ· Allow Create New | âš™ Dropdown Filter | âš™ Multi-Select |
  âš™ Cross-File | âš™ Ref File Label | Active

**FILE 2 FK Relations (V7)**

  REL-047: PO_LINE_ITEMS.PO Code â†’ PO_MASTER.PO Code
  REL-048: PO_MASTER.Supplier Code â†’ SUPPLIER_MASTER.Supplier Code
  REL-049: PO_LINE_ITEMS.Item Code â†’ poly-FK (routes to item master
           based on Item Master Type column)
  REL-050: GRN_MASTER.PO Code â†’ PO_MASTER.PO Code
  REL-051: GRN_LINE_ITEMS.GRN Code â†’ GRN_MASTER.GRN Code
  REL-052: GRN_LINE_ITEMS.PO Line Item â†’ PO_LINE_ITEMS via composite
  REL-053: PO_MASTER.Season â†’ SEASON_MASTER.Season Code
  REL-054: PO_MASTER.Currency â†’ CURRENCY_MASTER.Currency Code

**Poly-FK Routing (V7)**

PO_LINE_ITEMS uses a dynamic FK where the target sheet depends on the
Item Master Type column value:

  FABRIC     â†’ RM_MASTER_FABRIC
  YARN       â†’ RM_MASTER_YARN
  WOVEN      â†’ RM_MASTER_WOVEN
  TRIM       â†’ TRIM_MASTER
  CONSUMABLE â†’ CONSUMABLE_MASTER
  PACKAGING  â†’ PACKAGING_MASTER

GAS function: resolvePolyFK(itemCode, itemMasterType)

**GAS Functions Required**

1. getFKDropdown(parentSheet, parentColumn) â€” reads MASTER_RELATIONS
   â†’ returns code+name pairs filtered Active=Yes

2. createNewFKRecord(referencedSheet, formData) â€” mini-form sidebar
   â†’ writes to referenced master â†’ returns new code

3. autoDisplayFKName(code, sheet, nameCol) â€” fills adjacent â† column

4. resolveCrossFileFKName(code, fileLabel) â€” Layer 2 cache

5. resolvePolyFK(itemCode, itemMasterType) â˜… V7 â€” routes to correct
   item master based on type

**6. ATTRIBUTE SYSTEM â€” TRIM / CONSUMABLE / PACKAGING**

Three sheets work together for each item type. Same as V4.

**ğŸ”’ Special Rule: Color(REF NAME) Attribute**

> When attr name = "Color(REF NAME)" â€” GAS IGNORES ATTR_VALUES and
> loads COLOR_MASTER color names as the dropdown instead. Permanently
> locked.

**7. ITEM_SUPPLIER_RATES MODULE (FILE 1B â€” SHEET 43)**

Same architecture as V4. Option C Hybrid (locked). One row per
item+supplier combination.

**8. SIXTEEN GAS MODULES â€” BUILD ORDER & FUNCTIONS â˜… V7**

Expanded from 8 to 16 modules to support Notion features, Procurement
transactions, Help system, and Admin configurators.

**Module 1 â€” Code Generation**
- generateItemCode(sheetName, category) â€” increments per category
- validateCodeFormat(code, sheetName) â€” regex check
- Lock # cells after writing

**Module 2 â€” FK Relationship Engine**
- getFKDropdown(parentSheet, parentColumn)
- createNewFKRecord(referencedSheet, formData)
- autoDisplayFKName(code, sheet, nameCol)
- resolveCrossFileFKName(code, fileLabel)
- resolvePolyFK(itemCode, itemMasterType) â˜… V7

**Module 3 â€” Attribute System (4 Directions)**
- autoFillAttrNames(sheet, row, category)
- getAttrValueDropdown(category, attrName) â€” Color(REF NAME) â†’ COLOR_MASTER
- syncNewAttrName(sheet, category, newName)
- syncNewAttrValue(category, attrName, newValue)

**Module 4 â€” Change Log**
- writeChangeLog(action, sheet, itemCode, field, oldVal, newVal, userEmail)
> ğŸ”’ ITEM_CHANGE_LOG is GAS-written only. Never allow manual entry.

**Module 5 â€” Access Control**
- checkUserAccess(email, sheetName, actionType) â€” reads USER_MASTER
- onOpen â†’ hide sheets, lock ranges, show role-relevant menus

  Role Matrix:
  SUPER ADMIN   â†’ All 56 sheets + 7 procurement
  ADMIN         â†’ All item + factory + procurement masters
  PURCHASE MGR  â†’ Supplier, ISR, Payment Terms, PO, GRN
  PRODUCTION MGR â†’ Process, Work Center, Machine
  STORE KEEPER  â†’ Warehouse, Bin, Spare Parts
  ACCOUNTS      â†’ Finance masters
  VIEW ONLY     â†’ Read-only on allowed sheets

**Module 6 â€” Color Swatch**
- applyColorSwatch() â€” on COLOR_MASTER hex change â†’ set cell bg

**Module 7 â€” Reorder Alert**
- Scheduled daily 8am trigger
- Check all items: Current Stock < Reorder Level â†’ email alert

**Module 8 â€” ITEM_SUPPLIER_RATES PO Sidebar**
- getItemSuppliers(itemCode)
- selectSupplierForPO(itemCode)
- updateLastPOData(rateCode, poDate, poPrice)

**Module 9 â€” Procurement PO â˜… V7**
- createPO(supplierCode, type, season, lineItems[])
- updatePOStatus(poCode, newStatus) â€” validates workflow transitions
- getPOWithLineItems(poCode) â€” returns header + lines + rollups
- getPOList(filters) â€” paginated list with status/type/season filters
- applyTemplate(templateId, overrides) â€” reads TEMPLATES â†’ pre-fills

**Module 10 â€” Procurement GRN â˜… V7**
- createGRN(poCode, vehicleNo, dcNo, gatePass, lineItems[])
- updateGRNStatus(grnCode, newStatus)
- getGRNWithLineItems(grnCode)
- autoUpdatePOStatus(poCode) â€” recalculates PO status from GRN totals

**Module 11 â€” Status Workflow Engine â˜… V7**
- getWorkflow(module) â€” reads STATUS_WORKFLOW â†’ returns statuses + transitions
- validateTransition(module, currentStatus, newStatus) â€” checks allowed_next
- getStageGroup(module, status) â€” returns Not Started / In Progress / Complete
- executeAutoActions(module, status) â€” triggers automation rules on status change

**Module 12 â€” Rollup Engine â˜… V7**
- getRollups(parentSheet, parentCode) â€” reads ROLLUP_CONFIG â†’ computes aggregates
- computeRollup(config) â€” executes COUNT/SUM/AVG/MIN/MAX/LAST on source data
- Cached Layer 1 â€” recalculates on child record changes via Smart Invalidation

**Module 13 â€” Embedded Views Engine â˜… V7**
- getEmbeddedViewData(parentRef, viewId) â€” reads EMBEDDED_VIEWS config â†’ fetches filtered child data
- All views respect Active=Yes filter
- Cached Layer 1 â€” invalidated when source data changes

**Module 14 â€” Notification & Automation Engine â˜… V7**
- sendNotification(recipientRole, title, detail, type, link)
- evaluateAutomationRules(module, trigger, recordData) â€” reads AUTOMATION_RULES
- executeAction(ruleConfig, recordData) â€” notify / update_field / create_record

  Trigger types: status_change | record_create | field_update | threshold
  Action types:  send_notification | update_field | create_linked_record | send_email

**Module 15 â€” Help System â˜… V7**
- getHelpContent(role, module) â€” reads HELP_CONTENT filtered by Active + role
- getContextualHelp(role, module) â€” filtered by Related Module
- searchHelp(query, role) â€” full-text search across Title + Tags + Content
- Cached Layer 1 (6hr) â€” help pages rarely change

**Module 16 â€” Admin Configurator CRUD â˜… V7 (Phase 3C)**
- saveEmbeddedView(config) / updateEmbeddedView / deleteEmbeddedView
- saveRollupConfig(config) / updateRollupConfig / deleteRollupConfig
- saveWorkflowConfig(module, statuses[]) / addWorkflowStatus / deleteWorkflowStatus
- saveTemplate(module, templateData) / updateTemplate / deleteTemplate
- saveAutomationRule(module, ruleData) / updateAutomationRule / toggleAutomationRule
- Helper functions:
  getAvailableSheets() â†’ powers all configurator dropdowns
  getAvailableFKColumns(parentSheet, childSheet)
  getAggregableColumns(sheet)
  getTemplatePreFillOptions(module)

**9. THREE-LAYER CACHE SYSTEM (LOCKED)**

Same architecture as V4. Never query master sheets live on every cell edit.

  Layer 1: CacheService          â€” Session â€” 6 hours
  Layer 2: PropertiesService     â€” Cross-file â€” Daily refresh 7am
  Layer 3: Smart Invalidation    â€” Targeted â€” Event-triggered

**Cache Keys for V7 Additions:**

  help_content_{role}_{module}     â€” Layer 1 â€” 6hr â€” help pages
  workflow_{module}                â€” Layer 1 â€” 6hr â€” status definitions
  rollup_{parentSheet}_{parentCode} â€” Layer 1 â€” recalc on child change
  embedded_{viewId}                â€” Layer 1 â€” invalidate on source change
  automation_{module}              â€” Layer 1 â€” 6hr â€” rule definitions

**Performance Targets (Must Meet)**

  Sheet open:            2â€“4 seconds
  FK dropdown response:  < 0.5 seconds
  Attr names auto-fill:  < 0.3 seconds
  Write / save record:   2â€“4 seconds
  Help panel load:       < 1 second â˜… V7
  Rollup computation:    < 1 second â˜… V7

**10. TAG SYSTEM**

Same as V4. TAG_MASTER has 28 starter tags. Tags on 6 masters.

**11. DATA SAFETY RULES â€” MANDATORY**

> **ğŸ”’ RULE:** NEVER delete existing data rows when rebuilding or
> modifying a sheet. Changes are incremental only.
>
> **ğŸ”’ RULE:** When modifying sheet structure: load existing sheet â†’
> make targeted changes â†’ save. Never start from blank.
>
> **ğŸ”’ RULE:** ITEM_CHANGE_LOG must be protected â€” GAS-written only.
>
> **ğŸ”’ RULE:** Color(REF NAME) does NOT have rows in any ATTR_VALUES
> sheet â€” intentional. Do not add them.
>
> **ğŸ”’ RULE:** Article Code format: 5249HP â€” NO space, NO prefix.

**12. TRIM VARIANT SYSTEM**

Same as V4. Option B: Sequential code + Parent Code column.

**13. FILE 2 â€” PROCUREMENT SHEETS â˜… V7**

  ---------- ---------------------- ------------- ---------------------------
  **Sheet**  **Name**               **Cols**      **Notes**

  1          PO_MASTER              28 cols       Header: Supplier FK, Type,
                                                  Season, Terms, âˆ‘ totals

  2          PO_LINE_ITEMS          22 cols       Poly-FK items, auto UOM/
                                                  HSN/GST from masters

  3          GRN_MASTER             26 cols       Links PO, Vehicle/DC/Gate,
                                                  QC status

  4          GRN_LINE_ITEMS         20 cols       Recv/Accept/Reject qtys,
                                                  Batch, Roll-wise data

  5          MASTER_RELATIONS_F2    12 cols       REL-047 to REL-054

  6          TEMPLATES              14 cols       11 templates (8 PO types +
                                                  3 GRN types, TPL-001)

  7          RECORD_COMMENTS        10 cols       Threaded comments with
                                                  @mentions (CMT-00001)
  ---------- ---------------------- ------------- ---------------------------

**14. NOTION-STYLE CONFIG SHEETS â˜… V7**

Five config sheets enable feature expansion through row additions. No
code changes needed to add features â€” just add config rows.

  **FILE 1A:**
  STATUS_WORKFLOW (Sheet 26)    â€” 48 rows â€” Module workflow states
  EMBEDDED_VIEWS (Sheet 27)     â€” 16 rows â€” Linked database views
  ROLLUP_CONFIG (Sheet 28)      â€” 24 rows â€” Aggregate summary cards
  HELP_CONTENT (Sheet 29)       â€” 13 rows â€” In-app help pages â˜… V7

  **FILE 1B:**
  AUTOMATION_RULES (Sheet 51)   â€” 8 rows â€” Event-driven automations

**Config sheets are module-agnostic.** To add support for a new module:
add rows to config sheets. No code changes needed.

**15. IN-APP HELP SYSTEM â˜… V7**

HELP_CONTENT sheet stores instruction pages as Markdown. React HelpPanel
renders them in a 420px slide-in panel with search.

**HELP_CONTENT Columns (14):**
ğŸ”‘ Help ID | âš  Category | âš  Section | Title | Content (Markdown) |
Target Audience | Related Module | Related Config Sheet | Sort Order |
Icon | Tags | Last Updated By | Last Updated | Active

**Categories:** Getting Started | Module Setup | Config Guide |
Troubleshooting | FAQ | Release Notes

**Smart Behaviours:**
1. Contextual help â€” auto-shows pages relevant to current module
2. Role filtering â€” Operators don't see Admin-only config guides
3. Search â€” fuzzy search across Title + Tags + Content
4. Module-specific "?" icons â€” direct link to relevant help page

**13 Pre-Populated Help Pages:**
HLP-001 to HLP-013 covering Welcome, Shortcuts, Status Badges,
PO/GRN how-to, Config Guides (5 pages), Troubleshooting (2 pages)

> **ğŸ”’ RULE (V7):** Claude must update HELP_CONTENT when changing
> architecture. New module â†’ add Module Setup pages. New config â†’
> add Config Guide page. This is mandatory, not optional.

**16. CONFIGURATOR PERMISSION MATRIX â˜… V7**

  Config Sheet      | Admin         | Manager          | Supervisor | Operator
  EMBEDDED_VIEWS    | âœ… CRUD any   | âœ… Add/Edit own  | âŒ         | âŒ
  ROLLUP_CONFIG     | âœ… CRUD any   | âœ… Add/Edit own  | âŒ         | âŒ
  STATUS_WORKFLOW   | âœ… CRUD any   | ğŸ‘ View only     | âŒ         | âŒ
  TEMPLATES         | âœ… CRUD any   | âœ… Add/Edit own  | âŒ         | âŒ
  AUTOMATION_RULES  | âœ… CRUD any   | ğŸ‘ View only     | âŒ         | âŒ
  HELP_CONTENT      | âœ… CRUD       | ğŸ‘ View only     | ğŸ‘         | ğŸ‘
  RECORD_COMMENTS   | âœ… Delete any | âœ… Own comments  | âœ… Own     | âœ… Own

**17. PHASE 1 BUILD SEQUENCE**

Build GAS modules in this order. Each step depends on the previous.

  Step  Task                                          Module
  1.1   Create all master files + sheet structure     â€”
  1.2   Dropdowns and data validation                 â€”
  1.3   Auto-code generators                          Module 1
  1.4   FK relationship engine via MASTER_RELATIONS   Module 2
  1.5   Attribute two-way sync                        Module 3
  1.6   ITEM_CHANGE_LOG onEdit trigger                Module 4
  1.7   Access control from USER_MASTER               Module 5
  1.8   CacheService Layer 1 session cache            Cache
  1.9   PropertiesService Layer 2 cross-file cache    Cache
  1.10  Smart invalidation Layer 3                    Cache
  1.11  COLOR_MASTER hex swatch auto-apply            Module 6
  1.12  Reorder alert scheduled trigger               Module 7
  1.13  ITEM_SUPPLIER_RATES PO sidebar                Module 8
  1.14  PO CRUD + line items + poly-FK â˜… V7           Module 9
  1.15  GRN CRUD + auto PO status update â˜… V7         Module 10
  1.16  Status workflow engine â˜… V7                   Module 11
  1.17  Rollup computation engine â˜… V7                Module 12
  1.18  Embedded views data engine â˜… V7               Module 13
  1.19  Notification + automation engine â˜… V7         Module 14
  1.20  Help system GAS functions â˜… V7                Module 15
  1.21  Admin configurator CRUD (Phase 3C) â˜… V7       Module 16

**18. REACT FRONTEND ARCHITECTURE â˜… V7**

React is the REAL production frontend. GAS serves purely as backend API.

**Component Tree:**
  <App>
    <ShellBar>
      <Logo> <Breadcrumb> <SearchBar (Ctrl+K)>
      <ThemeToggle> <NotifBell> <HelpButton â˜…> <Presence> <Settings>
    </ShellBar>
    <Sidebar>
      <QuickAccess> <Recent> <Frequent> <Modules>
    </Sidebar>
    <MainContent>
      <ModuleListView>
        <ViewSwitcher (Table/Kanban/Calendar/Gallery)>
        <SavedFilterTabs> <FilterBar>
        <TableView / KanbanView / CalendarView / GalleryView>
      </ModuleListView>
      â€” OR â€”
      <RecordDetail>
        <StatusBadge> <RollupCards> <ConfigButtons â˜…>
        <CollapsibleSections> <LineItems>
        <LinkedDBViews> <Comments>
      </RecordDetail>
    </MainContent>
    <HelpPanel â˜…> (420px right slide-in)
    <NotifPanel> <CtrlKPalette> <TemplatePicker>
    <ConfiguratorModals â˜…>
      <EmbeddedViewConfigurator>
      <RollupConfigurator>
      <WorkflowEditor>
      <TemplateEditor>
      <AutomationRuleBuilder>

**19. THREE CONFIGURATION PATHS â˜… V7**

All 3 paths write to the SAME config sheets.

**Path 1 â€” Manual Sheet Editing**
Open Google Sheet â†’ navigate to config sheet â†’ add row following R2/R3

**Path 2 â€” Claude-Assisted Configuration**
Tell Claude the requirement â†’ Claude generates row â†’ writes to .xlsx

**Path 3 â€” Admin UI Configurator (Phase 3C)**
Admin opens ERP â†’ clicks "+ Add" button â†’ visual modal â†’ GAS validates
â†’ writes row â†’ React refreshes immediately

**20. PDF TEMPLATE SYSTEM**

> **ğŸ”’ RULE:** Never auto-add to PDF_TEMPLATE_REGISTRY. Create PDF â†’
> show Saurav â†’ wait for explicit approval â†’ only then provide
> registry entry to paste.

**21. LOCKED DECISIONS â€” DO NOT RE-OPEN**

These decisions are permanently locked. To change any: explicit override
from Saurav with phrase "Override decision [name]".

  Decision                          Locked Choice
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ERP Platform                      Google Sheets + GAS â€” no alternatives
  No company prefix                 CC- NEVER used in any code
  RM master structure               3 separate: Fabric / Yarn / Woven
  Item code style                   Sequential with category prefix
  Variant tracking                  Parent Code column â€” not suffix
  Attribute system                  ATTR_NAMES + ATTR_VALUES 4-way sync
  FK approach                       Store code only + GAS auto-display
  MASTER_RELATIONS                  Central config drives ALL FKs
  Audit trail                       ITEM_CHANGE_LOG GAS-written only
  GAS 3-layer cache                 CacheService + PropertiesService + Smart
  TAG system                        TAG_MASTER + âŸ· Tags on 6 masters
  Article code format               5249HP â€” NO space, NO prefix
  Multi-supplier architecture       Option C Hybrid
  ISR scope                         All 6 item masters
  Color(REF NAME) attr              Loads COLOR_MASTER â€” bypasses ATTR_VALUES
  Trim color FK                     TRIM_MASTER col 7 â†’ COLOR_MASTER
  AGT trim category                 Removed permanently
  ISR Priority                      Primary â†’ Secondary â†’ Backup â†’ Approved
  ISR GST%                          ISR col 10. âˆ‘ calculated col 11.
  React = REAL frontend â˜… V7        GAS = backend API via google.script.run
  Dual-path config â˜… V7             Manual + Claude + Admin UI configurators
  Build sequence â˜… V7               Foundation â†’ Polish â†’ Notion â†’ Configurators
  Help system â˜… V7                  HELP_CONTENT + HelpPanel. Claude-maintained.
  Notion config sheets â˜… V7         Module-agnostic. Add rows = add features.
  PDF template approval â˜… V7        Never auto-add. Create â†’ show â†’ approve.

**22. MANDATORY CLAUDE SESSION PROTOCOL**

Before ANY work on CC ERP:

1. Read BUILD_REF_V7.md + UI_SPEC_V6.md + GAS_Custom_Instructions
2. Read Masters_V8.xlsx (56 sheets) + FILE2_Procurement_V2.xlsx (7 sheets)
3. Confirm in 3 lines max. Never re-ask what is in the reference doc.
4. Check Section 14 locked decisions â€” never re-open without override.
5. Follow data safety rules â€” never delete rows, incremental only.

**27 RULES SUMMARY:**

1.  Freeze A4 always
2.  â†’ FK stores code only, â† auto-display
3.  # cells locked after generation
4.  Color(REF NAME) â†’ COLOR_MASTER bypass
5.  No CC- prefix anywhere
6.  Article code: 5249HP format
7.  ITEM_CHANGE_LOG: GAS-only writes
8.  Cache hierarchy: L1 â†’ L2 â†’ L3
9.  Cross-file FKs use Layer 2 cache
10. Smart invalidation: clear only edited master's cache
11. Tag system: TAG_MASTER + âŸ· column on 6 masters
12. Multi-supplier: Option C Hybrid architecture
13. ISR Priority: Primary â†’ Secondary â†’ Backup â†’ Approved
14. Data safety: never delete rows, incremental changes only
15. Sheet count: 56 master + 7 procurement = 63 total
16. Build sequence: Modules 1-8 first, then 9-16
17. FK relations: MASTER_RELATIONS (REL-001â†’046) + F2 (REL-047â†’054)
18. Config sheets: 5 Notion + HELP_CONTENT = 6 config sheets
19. Templates: TEMPLATES sheet in FILE 2 (TPL-001 format)
20. Comments: RECORD_COMMENTS (CMT-00001 format)
21. Poly-FK: Item Master Type routes to correct item master
22. Notion config is module-agnostic â€” add rows, not code
23. Automation: 4 trigger types, 4 action types
24. Configurator permissions: Admin=CRUD, Manager=own, others=view/none
25. PDF templates: create â†’ approve â†’ register (never auto-add)
26. React = REAL frontend, GAS = backend API only
27. Claude must update HELP_CONTENT when changing architecture

+-----------------------------------------------------------------------+
| Confidence Clothing ERP â€¢ CC_ERP_BUILD_REFERENCE_V7.md â€¢ V7           |
| Feb 2026                                                              |
|                                                                       |
| 54 FK relations (REL-001 to REL-054) â€¢ 63 sheets total               |
| 16 GAS Modules â€¢ 3-Layer Cache â€¢ 5 Notion Config Sheets              |
| 13 Help Pages â€¢ 11 Templates â€¢ 8 Automation Rules                    |
| React Frontend + GAS Backend â€¢ Dual-Path Configuration               |
+-----------------------------------------------------------------------+
